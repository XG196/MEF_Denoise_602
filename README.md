

Multi-Exposure Image Fusion with Denoising

Xinyu Guo (20847775)

April 2020

1 Introduction

The range of luminance levels in the natural scenes are usually high dynamic, the irradiance across a

scene varies a lot, when taking an image of a scene; no matter what exposure time is used, there will

usually exists some area of the image to be over- or under-exposed. On the other hand, there is a big

gap between the luminance range of low dynamic standard display devices. The Multi-Exposure Image

Fusion (MEF) algorithm try to solve these problems, by fusing a sequence of differently exposed images

to one single image.

Many algorithms are proposed to solve this problem. Most of them are pixel or patch weighting

based method, in these methods, the weight for each pixel or each patch is calculated, then the fused

image is generated by combining these weighted pixels or patches. The weights are computed based on

different hypothesis which result in different MEF algorithms. For example, Laplacian pyramid is used

to calculate pixel weights[1], in this method, Laplacian pyramid is used to decompose an image into

different component. The one with ﬁne details can be served as weighting map. Also, entropy based

patch selection method is adopted to fuse input sequence[2]. One of the state of the art MEF algorithms

proposed recently is MEF-SSIM c [3], which is a numerical optimization based method. Taking the

a sequence of color images as input, MEF-SSIM c aim to produced a fused image by comparing the

similarity between the input and the fused image. The fused image is generated by an optimization

process.

However, the MEF algorithms usually applied on clean input images, which is diffenerent from

the practical situations. In this work, the aim is to make innovation based on the above MEF-SSIM

c

algorithm and the innovation is made by generalization. In the real environment, a image will go through

several process before reaching the consumer. Such as image acquisition and transmission. Noise can

be added to image during such processes. For example, the sensor in the camera may introduce noise to

image data. Thus, this work aim to generalize the original solution to a more complex setting. A CNN-

based denoising module is added to the MEF algorithm,this denoising alogorithm is applied to input

noisy sequence before they enter the MEF algorithm. The denoising CNN [4] is trained on different

noise levels, and the fused image is generated using the numerical optimization method operating on the

joint denoising and similarity comparison pipeline.

2 Literature Review

Over the past decades, lots of MEF algorithms are proposed, ranging from simple weighted summation

methods to complex statistical methods. A simple algorithm to determine weights are local and global

energy weighting approaches. In which, local energy and global energy are used for computing the

weights. Some pixel based weighting methods are proposed, Laplacian pyramid is used by Burt to

completing binocular image fusion [1], in which, pyramid parameters are used to compute the weight

used for fusion. A multi-explosure fusion algorithm is later developed by Mertens [5]. In this method,

contrast, saturation and well-exposedness are quantiﬁed at pixel level. Then these values are multiplied

together which yield weights for pixels. Bilateral ﬁlter is adopted by Raman to create weighting map[6],

1





in this method, utilizing the edge preserving and smoothing feature of bilateral ﬁlter, the weighting map

contains the texture and weak edge of original image, which is served to detect over- or under-exposure.

A improvement method named boosting Laplacian pyramid is proposed later, in which a hybrid exposure

quality weight is used to fused a sequence of input to one output[7]. The hybrid exposure quality

weight is calculated by considering the global exposure weight, local exposure weight and saliency

weight. Also, there are some patch based weighting methods. A entropy based patch selection method

is proposed, the patch with the higheset entropy is consider to construct the fused image[2], however,

because the patch position is determined in a non-overlapping fashion, blocking artifacts are appeared

in this method. Later, a structural comparison method for patch decomposition is proposed, the patch is

decomposed to signal strength, signal structure and mean, and the position is determined using a sliding

window approach, then a new patch is reconstruction for image fusion [8]. Because patches are chosen

by applying a sliding window, the blocking artifact can be reduced. In [9], contrast and gradient are ﬁrst

calculated, then the fused image is synthesised by suppressing reversals in image gradient.

A important problem in this domain is the misalignment problem. When the object in the scence is

moving or the camera is moving, the sequence of the input images can be misaligned. A gradient guided

fusion method is proposed, the gradient is computed and used to distinguish the moving object from

the background [10]. Later on, the dynamic scene problem is solved by using a ghost removal pipeline.

Firstly dectcting the non-consistency pixels, then the detected pixels are corrected [11]. Another method

to tackle this problem is proposed by Qin et al. [12], in their work, a matching algorithm which operate

at image patch level is developed to to keep track of the motion in the input sequence.

A numerical optimization based method for multi-exposure image fusion is proposed recently [3].

In this method, patches with highest contrast is consider to be the well-exposed, and a optimal exposure

image is constructed by combining all selected patches at different position together. This optimal image

and a initial image is measured using color image structure simiilarity index. The aim is to maximize

the output structure similarity index by keep updating the given initial image.

3 Proposed Solution

As mentioned above, a denoising-based MEF method is proposed to generalize the original solution to

a more general setting. For denoising purpose, A CNN-based denoising module is trained and added to

the MEF-SSIM c. The overall algorithm ﬂow can be seen in Figure 1. Firstly, the input noisy sequence is

put in the denoising CNN, the denoising CNN will reduce the noise and give the noise-reduce sequence

to MEF-SSIM algorithm. The patch selection is the ﬁrst step of MEF-SSIM algorithm, at each

c

c

location, a patch with highest contract is selected and go through the structure similarity comparison

with the corresponding patch in random initial image. This process gives quality score for each patch.

Then we use gradient ascent algorithm to increase the quality score by adjusting each patch in random

initial image. Finally, the fused image is created.

Figure 1: Block diagram of proposed solution

2





In this section, ﬁrstly, the denoising based MEF algorithm is introduced. Then, some of the results

are presented. Finally, methods used in comparative study are brieﬂy introduced.

In the proposed MEF algorithm, a CNN-based denoising module is ﬁrstly applied to the input se-

quence. For the CNN, We adopted the network structure design in [4].

Figure 2: Network structure of the denoising CNN [4]

As shown in Figure 2. The denoising CNN consist of 17 layers. For the ﬁrst layer, 64 convolution

kernels with size 3 × 3 are applied to the input images, followed by a ReLU function. The middle 15

layers follow a same structure. These layers are composed of a convolutional layer with 64 3×3 kernels,

a batch nomalization layer and a ReLU layer. The last layer of the network is a convolution later with

one 3 × 3 kernel which output a residual image. The input of the network is a grayscale image. The

network try to predict the residual which is the difference between the noisy image and the reference

image.

The CNN is applied to the input noisy images. Since the input noisy images are color images,

we ﬁrstly split the color images by R, G, B three channels, and our model is applied to each channel

respectively. The output image is obtained by concatenating three channels together. Let X represents

k

the kth noisy image in the input noisy sequence, then the denoising process can be express by X = f(X ).

¯

k

k

The function of denoising CNN is represented by f

The following MEF-SSIMc algorithm takes a sequence of noise-reduced color images and a initial

images created at a random starting point as inputs, this algorithm create the ﬁnal fused image by a

comparison and optimization process. The comparison is done at patch level. Firstly, each image in

the image sequence is divided into patches using a sliding window. For each patch, the patch strength

is computed by calculating the standard deviation of the patch, and the patch with the highest patch

strength is selected. Then, the patch intensity is obtained by following equations:

∑K u µ l l

(

, )

ˆ

l =

k

=1

k

k k

∑K u µ l

(

, )

k k

k=1

¯

where µ is the mean intensity of whole color image X , l is the mean intensity the patch. The weighting

k

k

k

function is a 2 dimensional gaussian function:



!

(µ − µ )

2

(l −l )

2

k

c

k

c

u(µ ,l ) = exp −

−

k

k

2σ2

2σ2

g

l

where µ and l are constants representing the middle intensity. For normalized images, the values

c

c

are 0.5. σ and σ control the shape of the function along two dimensions. Finally, the patch-wise

g

l

comparison is done by computing the structural similarity index, and the structural similarity for the

whole between the whole sequence and the initial image is done by averaging the patch level comparison

results:

~~ꢀ~~

~~ꢁ~~

(2µ µ +C ) 2σ +C

xˆ

y

1

xˆy

2

S({x¯ },y) = ~~ꢀ~~

~~ꢁꢀ~~

~~ꢁ~~

k

µ2 + µ2 +C

σ2 +σ2 +C

y

1

xˆ

y

2

xˆ

M

ꢀꢂ

ꢃ

ꢁ

1

M

¯

X

∑

Q

,Y =

S({x¯ (j)},y(j))

k

k

j=1

3





The aim of the proposed solution is to get the optimal fused images when the inputs is a noisy sequence,

We can obtain the optimal solution by keep adjusting Y to let cost function Q reach its maximum value:

Yopt = arg maxQ({f(X )},Y)

k

Y

The cost function here is different from the original one since the denoising CNN is combined. We solve

it using the gradient ascent-based method adopted in the original MEF-SSIM c paper:

Yi+1 = Y +λ∇ Q({f(X )},Y)

i

Y

k

We implement out proposed solution using PyTorch. For the denoising part, The training data, parame-

ters and hyper-parameters are same with the ones used in [4]. This including the learning rate lr = 1e−3,

batchsize=128. However, different epochs are used for training on noisy images with different noise lev-

els. Here, we use 2 noise levels: σ = 5,15, and epochs are set to 15, 50 respectively. This is because

for smaller noise level, it is easier to train the neural network. Thus, we adopt fewer epochs which can

save some time. For creating the fused image, same here, most of the parameters are same with pre-

vious publication[3]. These parameters include two parameters for controlling shape of gaussian func-

tion σ = 0.2,σ = 0.2, the parameters for structure similarity comparison C1 = (K L)2,C2 = (K L)2.

g

l

1

2

L = 255 for 8 bits sequence, K1 = 0.01,K2 = 0.03, step size λ = 150 for gradient ascent method. The

iteration is set to 1500 for a easier implementation. After the optimizing, some example results can be

seen in Figure 3. The proposed solution can preserve the vivid color in the fused image produced by

MEF-SSIMc algorithm, while the noise in the fused image is reduced.

Figure 3: Visual comparison of MEF algorithms. (a) Source noisy sequence ”Arno” (σ = 15). (b) Result

of MEF-SSIMc. (c) Result of proposed solution

The MEF algorithm developed in [6] is adopted in comparative study. In this algorithm, the lumi-

nance of each pixel is computed using the RGB values, then a bilateral ﬁlter is applied on the luminance

image:

∑ ∑ f x0 y0 G

( , )

x

x0 y y0 G f x y

( ~~−~~ , ~~−~~ )

f x0 y0

f x0 y0

( ( , )− ( , ))

( ( , )~~−~~ ( , ))

y0 x0

σs

σr

BF(x,y) =

f

∑ ∑ G

y0 x0 σs

x

x0 y y0 G f x y

( − , − )

σ

r

ꢄ

ꢅ

ꢆ

ꢇ

(x2+y2

2σs2

)

a2

where G (x,y) = exp −

is a spatial domain gaussian ﬁlter, G (a) = exp −

sity domain gaussian ﬁlter, (x0,y0) is the neighbour of (x,y).

is an inten-

σ

σ

r

s

2σ2

r

4





A entropy based MEF algorithm is also adopted in the comparative study [13]. Firstly, the image

sequence is transformed to log domain, in circular region deﬁned by parameter R, the cross exposure

normalized log-scale local entropy is computed using:

Hklog(i, j)

norm

H

(i, j) =

k

log

∑N Hk i j

( , )

k=1

Based on the local entropy, the weight of each pixel in the exposure sequence is computed, the weights

are further adjusted using the exponential function. Finally, weights are normalized and applied to

multi-exposure input sequence.

4 Experimental Results

Twenty four source image sequences used in [3] are adopted here. The visual demonstration in Figure 4

shows some of the source sequence and noisy source sequences.

Figure 4: Visual comparison source sequence and noisy source sequence (σ = 15)

The proposed solution is compared with MEF-SSIMc[3], a entropy based MEF algorithm [13], a

bilateral ﬁlter based MEF algorithm [6]. These algorithms are compared using the same input noisy

source sequences. For the MEF-SSIMc algorithm and the proposed solution, the initial images are both

random gaussian noise with µ = 0,σ = 1.

Firstly, the visual comparison of fused images created by different MEF algorithms are conducted.

The inputs is the ”Farmhouse” image sequence, the demonstration is provide in Figure 5.

From Figure 5 we can see that the fused images produced by Raman09 and Bruce14 are darker and

there are noise inside the fused images. These two weakness points reduce the visual quality of the fused

image created by them. The color produced by Raman09 and Bruce14 is not as good as that produced by

MEF-SSIM algorithm. The proposed method can produce the color as vivid as MEF-SSIM algorithm

c

c

and reduce the noise using the CNN component in the algorithm.

Next, the algorithms are compared by quantized values. The color version structural similarity index

betweeen the fused images created by four different algorithms and the source sequence is calculated.

The reference image is create from the source sequence using the patch selection method. The patches

with highest contrast at each spatial location is selected to be the representative at that location. The

select patch is compared with patch extracted from the fused images created by each algorithm. Then

for each algorithm, we can get a SSIMc score for each image content. The algorithms are compared at

two different noise levels using 24 difference image contents. The results are presented in the table.

From Table 1 we can the proposed solution gives better results compared with other algorithms on

noisy input sequences. In the ”Average” row in the table, the SSIMc score given by proposed solution

at two noise levels outperform the scores given by other algorithms. When the noise level raise from

5 to 15, all other algorithms performance drops signiﬁcantly, however, with the denoising module the

proposed solution just drops a little. Also, the inﬂuence of noise to different algorithm can be different.

5





Image

Noise

Raman09

Bruce14

MEF-SSIMc

Denoising MEF-SSIMc

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

σ = 0

σ = 5

σ = 15

0.8156

0.7971

0.6768

0.7248

0.7167

0.6585

0.5008

0.4781

0.3818

0.8579

0.8196

0.6651

0.9557

0.9494

0.9070

0.6771

0.6558

0.5683

0.5178

0.4984

0.4177

0.5384

0.5189

0.4338

0.8681

0.8454

0.7337

0.8700

0.7928

0.5229

0.7741

0.7355

0.5775

0.4244

0.4261

0.3731

0.9223

0.8825

0.7248

0.8672

0.7970

0.5534

0.8171

0.7894

0.6655

0.8374

0.7944

0.6241

0.6800

0.6617

0.5742

0.7865

0.7349

0.5471

0.5487

0.5375

0.4873

0.7624

0.7195

0.5548

0.8784

0.8126

0.5540

0.5844

0.5697

0.4950

0.7634

0.7316

0.5842

0.7694

0.7422

0.6296

0.7393

0.7086

0.5797

0.8633

0.8315

0.6995

0.8240

0.7945

0.7095

0.5704

0.4913

0.3717

0.9196

0.8676

0.6860

0.9617

0.9492

0.9021

0.8232

0.7634

0.6176

0.5331

0.4626

0.3808

0.5692

0.5268

0.4269

0.9517

0.9175

0.7876

0.9131

0.8088

0.5156

0.8659

0.7962

0.6071

0.8689

0.7231

0.4836

0.9610

0.9158

0.7512

0.9029

0.8138

0.5523

0.9121

0.8629

0.7056

0.9033

0.8354

0.6282

0.8437

0.7661

0.6354

0.9102

0.8179

0.5896

0.5767

0.5582

0.4921

0.8647

0.7698

0.5758

0.9584

0.8624

0.5611

0.7295

0.6396

0.5311

0.8884

0.8305

0.6272

0.8772

0.8233

0.6698

0.8331

0.7678

0.6045

0.9583

0.9340

0.8143

0.9915

0.9807

0.9062

0.9902

0.9526

0.7867

0.9845

0.9441

0.7691

0.9980

0.9929

0.9553

0.9687

0.9444

0.8223

0.9800

0.9472

0.7975

0.9813

0.9526

0.7963

0.9946

0.9756

0.8625

0.9833

0.8945

0.5984

0.9919

0.9503

0.7501

0.9871

0.9471

0.7746

0.9948

0.9595

0.8064

0.9928

0.9222

0.6532

0.9867

0.9584

0.8104

0.9889

0.9449

0.7566

0.9893

0.9576

0.8192

0.9911

0.9375

0.7059

0.9796

0.9651

0.8822

0.9876

0.9362

0.7289

0.9954

0.9319

0.6542

0.9791

0.9554

0.8235

0.9743

0.9395

0.7592

0.9916

0.9607

0.8129

0.9859

0.9494

0.7853

\-

Room

0.9516

0.9349

\-

Church

Balloons

Kluki

0.9868

0.9697

\-

0.9836

0.9673

\-

0.9727

0.9404

\-

0.9971

0.9947

\-

0.9629

0.9461

\-

0.9731

0.9596

\-

0.9740

0.9569

\-

0.9909

0.9804

\-

0.9647

0.9311

\-

0.9767

0.9420

\-

0.9671

0.9026

\-

0.9884

0.9799

\-

0.9765

0.9464

\-

0.9783

0.9520

\-

0.9785

0.9546

\-

0.9835

0.9705

\-

0.9722

0.9190

\-

0.9727

0.9482

\-

0.9725

0.9501

\-

0.9744

0.9231

\-

0.9738

0.9608

\-

0.9598

0.9163

\-

0.9799

0.9426

\-

0.9755

0.9496

Yellow

House

Lamp

Belgium

Lighthouse

Ostrow

Mask

Cave

Set

Arno

Lauren

Ofﬁce

Farmhouse

Tower

Madison

Window

Landscape

Studio

Venice

Garden

Average

Table 1: Comparison between MEF algorithms

6





Figure 5: Visual comparison of different MEF algorithm (a) Input noisy source sequence (σ = 15)

(b) Fused image produced by Raman09[6] (c) Fused image produced by Bruce14[13] (d) Fused image

produced by MEF-SSIMc (e) Fused image produced by proposed solution

As noise level raise from 5 to 15, score for Bruce14 and MEF-SSIMc drop around 0.16, but Raman09

drops about 0.13. Another point to mention here is that the performance of MEF algorithm can vary

from sequence to sequence. For example, Raman09 and Bruce14 perform really poor on input sequence

with lots of exposure images, such as ”Balloons”, ”Lamp”, ”Belgium”, ”Madison” which have over 9

images in input sequence. However, the other two algorithms have better performance.

5 Discussion and Conclusions

As mentioned above, the denoising feature of MEF algorithm is quite important since in the real en-

vironment, a image will go through several process before reaching the consumer. Image acquisition

and transmission are some examples. As a result, noise can be added to image during such processes.

Noise can signiﬁcantly drop the performance of MEF algorithm by degrading the fused image quality

as shown in Figure 3. In Figure 3, it is obvious that the scene in (c) is more visual appealing to people

than (b). This can be also veriﬁed by the ﬁgures in Table 1, denoising based MEF-SSIMc algorithm has

much better performance that the algorithms without denoising module. The combination of denoising

module and MEF algorithm is based on the real situation and can help to reduce the inﬂuence of noise to

some extent.By combining denoising module into a MEF algorithm, there are some improvements. On

the one hand, the denoising algorithm successfully reduce the noise in the input sequence, as a result,

the MEF algorithm can take the noise-reduced sequence as its input and create more visual appealing

fused image. On the other hand, this combination let the whole algorithm take advantage of the state of

the art MEF-SSIMc algorithm. As the example listed above, for the input sequence with lots of images,

the MEF-SSIMc has a property to create vivid color in the fused images which is not achieved by other

compared MEF algorithms.

However, there are also some drawbacks in the proposed solution for future improvements. First

7





of all, the nosie module is built upon the MEF-SSIMc algorithm, which is one of the state of the art

algorithms in the ﬁeld. If the basic MEF algorithm can be improved, the performance of the combined

algorithm can have a better result as well. On the other hand, from Table 1, we can notice that, when

noice level improves, the score drops, this means the denoising algorithm used in the solution have some

space for improvement, the can be either using a direct color image denoising algorithm which fully

explore the correlation between color channels, or using a better grayscale image denoising algorithm.

References

[1] Peter J Burt. The pyramid as a structure for efﬁcient computation. In Multiresolution image

processing and analysis, pages 6–35. Springer, 1984.

[2] A Ardeshir Goshtasby. Fusion of multi-exposure images. Image and Vision Computing, 23(6):611–

618, 2005.

[3] Kede Ma, Zhengfang Duanmu, Hojatollah Yeganeh, and Zhou Wang. Multi-exposure image fu-

sion by optimizing a structural similarity index. IEEE Transactions on Computational Imaging,

4(1):60–72, 2017.

[4] Kai Zhang, Wangmeng Zuo, Yunjin Chen, Deyu Meng, and Lei Zhang. Beyond a gaussian de-

noiser: Residual learning of deep cnn for image denoising. IEEE Transactions on Image Process-

ing, 26(7):3142–3155, 2017.

[5] Tom Mertens, Jan Kautz, and Frank Van Reeth. Exposure fusion: A simple and practical alternative

to high dynamic range photography. In Computer graphics forum, volume 28, pages 161–171.

Wiley Online Library, 2009.

[6] Shanmuganathan Raman and Subhasis Chaudhuri. Bilateral ﬁlter based compositing for variable

exposure photography. In Eurographics (short papers), pages 1–4, 2009.

[7] Jianbing Shen, Ying Zhao, Shuicheng Yan, Xuelong Li, et al. Exposure fusion using boosting

laplacian pyramid. IEEE Trans. Cybernetics, 44(9):1579–1590, 2014.

[8] Kede Ma and Zhou Wang. Multi-exposure image fusion: A patch-wise approach. In 2015 IEEE

International Conference on Image Processing (ICIP), pages 1717–1721. IEEE, 2015.

[9] Mingli Song, Dacheng Tao, Chun Chen, Jiajun Bu, Jiebo Luo, and Chengqi Zhang. Probabilistic

exposure fusion. IEEE Transactions on Image Processing, 21(1):341–357, 2011.

[10] Wei Zhang and Wai-Kuen Cham. Gradient-directed multiexposure composition. IEEE Transac-

tions on Image Processing, 21(4):2318–2323, 2011.

[11] Zhengguo Li, Jinghong Zheng, Zijian Zhu, and Shiqian Wu. Selectively detail-enhanced fusion

of differently exposed images with moving objects. IEEE Transactions on Image Processing,

23(10):4372–4382, 2014.

[12] Xiameng Qin, Jianbing Shen, Xiaoyang Mao, Xuelong Li, and Yunde Jia. Robust match fusion

using optimization. IEEE transactions on cybernetics, 45(8):1549–1560, 2014.

[13] Neil DB Bruce. Expoblend: Information preserving exposure blending based on normalized log-

domain entropy. Computers & Graphics, 39:12–23, 2014.

8

